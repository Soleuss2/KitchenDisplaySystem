@model IEnumerable<SelfOrderingSystemKiosk.Models.ChickenFlavors>
@{
    Layout = "~/Areas/Customer/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Unlimited Menu";
}

<link rel="stylesheet" href="~/css/kiosk.css" />
<link rel="stylesheet" href="~/css/Menu.css" />
@await Html.PartialAsync("_Loader")
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<div class="container">
    <!-- Back Button -->
    <form asp-action="ChooseExperience" method="get" style="position:absolute;top:30px;left:40px;">
        <button type="submit" class="back-btn" title="Back to Experience Selection">
            <i class="bi bi-arrow-left-circle-fill" style="font-size: 2rem;"></i>
        </button>
    </form>

    <div class="menu-container">
        <!-- LEFT: MENU LIST -->
        <div class="menu-list">
            <div class="menu-header">
                <h1>CHICKEN WINGS MENU</h1>
                <p>Endless Wings — ₱377 per head</p>
                <h2 style="margin-top:20px;">UNLIMITED MENU</h2>
                <p>Choose from our delicious selection of flavorful chicken wings</p>
            </div>

            <!-- Tabs -->
            <div class="menu-tabs">
                <button class="active"><i class="bi bi-grid-1x2-fill"></i> All Items</button>
                <button><img src="~/images/wings.png" alt="Wings Icon" /> Wings</button>
                <button><img src="~/images/appetize.png" alt="Appetizer Icon" /> Appetizer</button>
                <button><i class="bi bi-basket"></i> Add-Ons</button>
            </div>

            <!-- Scrollable Menu Items -->
            <div class="menu-scroll">
                @foreach (var item in Model)
                {
                    <div class="menu-row">
                        <img src="@Url.Content(item.Image)" alt="@item.Name" />
                        <div class="menu-details">
                            <h4>@item.Name.ToUpper()</h4>
                        </div>
                        <button class="add-to-cart"
                                data-name="@item.Name"
                                data-price="377"
                                data-image="@Url.Content(item.Image)">
                            Add to cart
                        </button>
                    </div>
                }
            </div>
        </div>

        <!-- RIGHT: ORDER SUMMARY -->
        <div class="order-summary">
            <div class="summary-header">
                <h3>Order Summary</h3>
                <p class="item-count">0 Items</p>
                <p class="person-count">0 Person(s)</p>
            </div>

            <div class="summary-list">
                <div class="empty-cart">
                    <i class="bi bi-cart-x-fill" style="font-size: 3rem;"></i>
                    <p>Your cart is empty<br>Add items from the menu to get started</p>
                </div>
            </div>

            <div class="summary-footer">
                <p class="order-total">TOTAL: ₱0.00</p>
                <button class="confirm-btn">CONFIRM ORDER</button>
            </div>
        </div>
    </div>
</div>

<div id="notificationContainer" style="
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 10px;
"></div>

@await Html.PartialAsync("~/Areas/Customer/Views/Shared/Modals/_PersonModal.cshtml")
@await Html.PartialAsync("~/Areas/Customer/Views/Shared/Modals/_RulesModal.cshtml")
<script src="~/js/booking_cart.js"></script>

<script>
    // Confirm Order
    document.querySelector('.confirm-btn').addEventListener('click', function() {
        if(cart.length === 0){
            alert("Your cart is empty!");
            return;
        }

        // Prepare order items
        let orderItems = cart.map(c => ({
            ItemName: c.name,
            Quantity: c.quantity,
            Price: c.price
        }));

        fetch('/Customer/Kiosk/ConfirmOrder', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(orderItems)
        })
        .then(res => res.json())
        .then(data => {
            if(data.success){
                // Redirect to order tracking page
                window.location.href = '/Customer/Kiosk/Confirmation?orderNumber=' + data.orderNumber;
            } else {
                alert(data.message);
            }
        })
        .catch(err => console.error(err));
    });
</script>
